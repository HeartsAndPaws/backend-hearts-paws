<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Chat WebSocket Tester (Multiprop√≥sito)</title>
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      padding: 2rem;
    }
    input, button, select {
      margin: 5px;
      padding: 0.5rem;
    }
    #mensajes {
      margin-top: 1rem;
      padding: 1rem;
      border: 1px solid #ccc;
      max-height: 300px;
      overflow-y: auto;
      background: #f9f9f9;
    }
  </style>
</head>
<body>
  <h2>üîå Chat WebSocket Tester (Usuario / ONG)</h2>

  <div>
    <label>Rol actual: </label>
    <select id="rol">
      <option value="usuario">Usuario</option>
      <option value="ong">ONG</option>
    </select>
  </div>

  <div>
    <label>Chat ID: </label>
    <input id="chatId" type="text" placeholder="ID del chat" />
    <button onclick="unirseChat()">Unirse al Chat</button>
  </div>

  <div>
    <label>Tu ID (autorId): </label>
    <input id="autorId" type="text" placeholder="ID del autor (usuario u ong)" />
  </div>

  <div>
    <label>Mensaje: </label>
    <input id="mensaje" type="text" placeholder="Escribe tu mensaje" />
    <button onclick="enviarMensaje()">Enviar</button>
  </div>

  <div id="mensajes">
    <strong>üì® Mensajes:</strong>
    <div id="mensaje-lista"></div>
  </div>

  <script>
    const socket = io("http://localhost:3002/ws-chat"); // Cambiar si est√°s en producci√≥n

    socket.on("connect", () => {
      console.log("üü¢ Conectado al servidor:", socket.id);
    });

    socket.on("messageReceived", (msg) => {
      const div = document.createElement("div");
      const autorNombre = msg.autor?.nombre ?? `ID: ${msg.autorId}`;
      div.textContent = `üó®Ô∏è ${autorNombre}: ${msg.contenido}`;
      document.getElementById("mensaje-lista").appendChild(div);
    });

    function unirseChat() {
      const chatId = document.getElementById("chatId").value;
      if (!chatId) return alert("‚ö†Ô∏è Ingresa un ID de chat v√°lido");
      socket.emit("joinchat", { chatId });
    }

    function enviarMensaje() {
      const chatId = document.getElementById("chatId").value;
      const autorId = document.getElementById("autorId").value;
      const contenido = document.getElementById("mensaje").value;
      const rol = document.getElementById("rol").value;

      if (!chatId || !autorId || !contenido) {
        return alert("‚ö†Ô∏è Completa todos los campos");
      }

      // Enviamos el rol tambi√©n si luego quieres usarlo para l√≥gica de frontend
      socket.emit("sendMessage", {
        chatId,
        autorId,
        contenido,
        tipo: rol.toUpperCase(), // solo si planeas procesar esto en el backend
      });

      document.getElementById("mensaje").value = "";
    }
  </script>
</body>
</html>
